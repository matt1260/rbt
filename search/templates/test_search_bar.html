<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Bar Test - Chrome</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-header {
            background: #1a1a2e;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .test-header h1 {
            margin: 0 0 10px 0;
            color: #b78550;
        }
        
        .test-header p {
            margin: 0;
            color: #ccc;
        }
        
        .test-section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #b78550;
            padding-bottom: 10px;
        }
        
        /* Copy all styles from search_bar_with_live_search.html */
        .front_search {
            width: 100%;
            border: none;
            margin-bottom: 20px;
        }

        .front_search input[type="text"] {
            width: 80%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .front_search input[type="text"]:focus {
            outline: none;
            border-color: #b78550;
            box-shadow: 0 0 0 3px rgba(183, 133, 80, 0.15);
        }

        .front_search button {
            padding: 12px 24px;
            background: #b78550;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 10px;
        }

        .front_search button:hover {
            background: #965f35;
            transform: translateY(-2px);
        }

        .front td {
            padding: 15px;
        }

        .search-wrapper {
            position: relative;
        }

        .live-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            margin-top: 8px;
        }

        .live-results.active {
            display: block;
        }

        .result-item {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.15s;
            text-decoration: none;
            display: block;
            color: inherit;
        }

        .result-item:hover {
            background: #f8f9fa;
        }

        .result-reference {
            font-weight: 600;
            color: #b78550;
            margin-bottom: 5px;
        }

        .result-preview {
            font-size: 14px;
            color: #555;
            line-height: 1.5;
        }

        .result-preview mark {
            background: #ffeb3b;
            padding: 1px 3px;
            border-radius: 2px;
        }

        .results-meta {
            padding: 10px 15px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
            color: #666;
        }

        .no-results {
            padding: 20px;
            text-align: center;
            color: #999;
        }
        
        .debug-console {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .debug-console .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #4ec9b0;
        }
        
        .debug-console .error-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #f48771;
            color: #f48771;
        }
        
        .debug-console .success-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #4ec9b0;
            color: #4ec9b0;
        }
        
        .test-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .test-example {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .test-example:hover {
            background: #b78550;
            color: white;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>üîç Search Bar Live Test</h1>
        <p>Testing live search functionality with Chrome DevTools</p>
    </div>
    
    <div class="test-section">
        <h2>Reference Search Test</h2>
        <table class="front_search" style="border: none;">
            <tbody>
                <tr>
                    <td>
                        <div class="search-wrapper">
                            <form method="get" action="https://read.realbible.tech/" onsubmit="logEvent('Form submitted - Reference'); return true;">
                                <input type="text" name="ref" id="refInput" placeholder="Enter a reference..." autocomplete="off">
                                <button type="submit">Go</button>
                                <div class="live-results" id="refResults"></div>
                            </form>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <div class="test-examples">
            <div class="test-example" onclick="testSearch('refInput', 'John 3:16')">John 3:16</div>
            <div class="test-example" onclick="testSearch('refInput', 'Genesis 1:1')">Genesis 1:1</div>
            <div class="test-example" onclick="testSearch('refInput', 'Psalm 23')">Psalm 23</div>
            <div class="test-example" onclick="testSearch('refInput', 'Romans 8')">Romans 8</div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Keyword Search Test</h2>
        <table class="front_search" style="border: none;">
            <tbody>
                <tr>
                    <td class="front">
                        <div class="search-wrapper">
                            <form method="get" action="https://read.realbible.tech/" onsubmit="logEvent('Form submitted - Keyword'); return true;">
                                <input type="text" name="q" id="keywordInput" placeholder="Enter a search word..." autocomplete="off">
                                <button type="submit">Search</button>
                                <div class="live-results" id="keywordResults"></div>
                            </form>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <div class="test-examples">
            <div class="test-example" onclick="testSearch('keywordInput', 'love')">love</div>
            <div class="test-example" onclick="testSearch('keywordInput', 'faith')">faith</div>
            <div class="test-example" onclick="testSearch('keywordInput', 'salvation')">salvation</div>
            <div class="test-example" onclick="testSearch('keywordInput', 'grace')">grace</div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Debug Console</h2>
        <p style="color: #666;">Open Chrome DevTools (F12) to see network requests. Events logged here:</p>
        <div class="debug-console" id="debugConsole">
            <div class="log-entry">üîß Test page loaded. Ready to test...</div>
        </div>
    </div>

    <script>
        // Debug logging function
        function logEvent(message, type = 'log') {
            const debugDiv = document.getElementById('debugConsole');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error-entry' : type === 'success' ? 'success-entry' : 'log-entry';
            const icon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : 'üìù';
            
            const entry = document.createElement('div');
            entry.className = className;
            entry.textContent = `[${timestamp}] ${icon} ${message}`;
            debugDiv.appendChild(entry);
            debugDiv.scrollTop = debugDiv.scrollHeight;
            
            // Also log to browser console
            if (type === 'error') {
                console.error(`[Search Test] ${message}`);
            } else {
                console.log(`[Search Test] ${message}`);
            }
        }
        
        // Test helper function
        function testSearch(inputId, query) {
            const input = document.getElementById(inputId);
            input.value = query;
            input.focus();
            
            // Trigger input event to start search
            const event = new Event('input', { bubbles: true });
            input.dispatchEvent(event);
            
            logEvent(`Testing search: "${query}" in ${inputId}`);
        }

        // Live Search Functionality (same as in search_bar_with_live_search.html)
        (function() {
            let searchTimeout;
            const API_BASE = 'https://read.realbible.tech';
            
            logEvent(`API Base URL: ${API_BASE}`);
            
            function debounce(func, wait) {
                return function executedFunction(...args) {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => func(...args), wait);
                };
            }
            
            function setupLiveSearch(inputId, resultsId, searchType) {
                const input = document.getElementById(inputId);
                const results = document.getElementById(resultsId);
                
                if (!input || !results) {
                    logEvent(`‚ùå Could not find input ${inputId} or results ${resultsId}`, 'error');
                    return;
                }
                
                logEvent(`‚úÖ Setup live search for ${inputId} (${searchType})`, 'success');
                
                input.addEventListener('input', debounce(function(e) {
                    const query = e.target.value.trim();
                    
                    if (query.length < 2) {
                        results.classList.remove('active');
                        return;
                    }
                    
                    logEvent(`üîç Searching: "${query}" (${searchType})`);
                    
                    // Build search URL - API is at /api/live/ not /api/search/
                    let searchUrl;
                    if (searchType === 'reference') {
                        searchUrl = `${API_BASE}/api/live/?type=reference&q=${encodeURIComponent(query)}`;
                    } else {
                        searchUrl = `${API_BASE}/api/live/?type=keyword&q=${encodeURIComponent(query)}`;
                    }
                    
                    logEvent(`üì° API Request: ${searchUrl}`);
                    
                    fetch(searchUrl)
                        .then(response => {
                            logEvent(`üì• Response received: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                            return response.json();
                        })
                        .then(data => {
                            logEvent(`‚úÖ JSON parsed successfully`, 'success');
                            displayResults(data, results, query);
                        })
                        .catch(error => {
                            logEvent(`‚ùå Search error: ${error.message}`, 'error');
                            results.innerHTML = '<div class="no-results">Search unavailable</div>';
                            results.classList.add('active');
                        });
                }, 300));
                
                document.addEventListener('click', function(e) {
                    if (!input.contains(e.target) && !results.contains(e.target)) {
                        results.classList.remove('active');
                    }
                });
                
                input.addEventListener('focus', function() {
                    if (input.value.trim().length >= 2 && results.innerHTML) {
                        results.classList.add('active');
                    }
                });
            }
            
            function displayResults(data, resultsContainer, query) {
                // Handle different response formats
                let allResults = [];
                let totalCount = 0;
                
                logEvent(`üìä Processing results data...`);
                
                // Handle format from /api/live/
                if (data.ot_verses) {
                    allResults = allResults.concat(data.ot_verses || []);
                    logEvent(`  OT verses: ${data.ot_verses.length}`);
                }
                if (data.nt_verses) {
                    allResults = allResults.concat(data.nt_verses || []);
                    logEvent(`  NT verses: ${data.nt_verses.length}`);
                }
                if (data.references) {
                    allResults = allResults.concat(data.references || []);
                    logEvent(`  References: ${data.references.length}`);
                }
                
                // Calculate total
                if (data.counts) {
                    totalCount = (data.counts.ot_verses || 0) + (data.counts.nt_verses || 0) + (data.counts.references || 0);
                } else {
                    totalCount = allResults.length;
                }
                
                logEvent(`üìà Total results: ${totalCount} (showing ${Math.min(allResults.length, 5)})`, 'success');
                
                if (allResults.length === 0) {
                    resultsContainer.innerHTML = '<div class="no-results">No results found</div>';
                    resultsContainer.classList.add('active');
                    return;
                }
                
                let html = '';
                
                if (totalCount > 0) {
                    html += `<div class="results-meta">Found ${totalCount} result${totalCount !== 1 ? 's' : ''}</div>`;
                }
                
                const results = allResults.slice(0, 5);
                results.forEach(result => {
                    const displayText = result.display || `${result.book} ${result.chapter}:${result.verse}`;
                    const preview = result.text ? highlightMatch(result.text, query) : '';
                    html += `
                        <a href="${result.url}" class="result-item" target="_blank">
                            <div class="result-reference">${displayText}</div>
                            ${preview ? `<div class="result-preview">${preview}</div>` : ''}
                        </a>
                    `;
                });
                
                resultsContainer.innerHTML = html;
                resultsContainer.classList.add('active');
            }
            
            function highlightMatch(text, query) {
                if (!text || !query) return text;
                
                const escaped = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp(`(${escaped})`, 'gi');
                
                let truncated = text.substring(0, 200);
                if (text.length > 200) truncated += '...';
                
                return truncated.replace(regex, '<mark>$1</mark>');
            }
            
            document.addEventListener('DOMContentLoaded', function() {
                logEvent('üöÄ Initializing live search...', 'success');
                setupLiveSearch('refInput', 'refResults', 'reference');
                setupLiveSearch('keywordInput', 'keywordResults', 'keyword');
                logEvent('‚úÖ Live search initialized', 'success');
            });
        })();
    </script>
</body>
</html>
